<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>politinis_kampas — Home</title>
  <meta name="description" content="politinis_kampas — personal blog on world conflicts, analysis, and news." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" href="./favicon.ico" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="./index.html">politinis_kampas</a>
      <nav class="nav">
        <a href="./index.html" class="active">Home</a>
        <a href="./blog.html">Blog</a>
        <a href="./feed.html">RSS Feed</a>
        <a href="./about.html">About</a>
        <a href="./contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container grid">
    <section class="content">
      <h1 class="page-title">Latest from the blog</h1>

      <div id="latest-posts" class="latest-grid">
        <p class="muted">Loading posts…</p>
      </div>

      <div class="cta-row">
        <a class="btn" href="./blog.html">View all posts</a>
        <a class="btn ghost" href="./feed.html">Browse live RSS feed</a>
      </div>
    </section>

    <aside class="sidebar">
      <div class="widget">
        <h3 class="widget-title">Quick Links</h3>
        <ul class="list">
          <li><a href="./feed.html">Live Conflict Headlines</a></li>
          <li><a href="./blog.html">All Blog Posts</a></li>
          <li><a href="./about.html">About the Author</a></li>
          <li><a href="./contact.html">Contact</a></li>
        </ul>
      </div>

      <div class="widget">
        <h3 class="widget-title">Tags</h3>
        <div class="tags">
          <a href="./blog.html?tag=Europe">Europe</a>
          <a href="./blog.html?tag=Middle%20East">Middle East</a>
          <a href="./blog.html?tag=Africa">Africa</a>
          <a href="./blog.html?tag=Analysis">Analysis</a>
          <a href="./blog.html?tag=Explainer">Explainer</a>
        </div>
      </div>
    </aside>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <span>© <span id="year"></span> politinis_kampas</span>
      <a class="rss" href="./feed.html">RSS Feed Page</a>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== Configure your repo here ======
    const GITHUB_USER  = 'simke222';
    const GITHUB_REPO  = 'politinis_kampas';
    const GITHUB_BRANCH = 'main';
    // ======================================

    const postsApi = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/posts?ref=${GITHUB_BRANCH}`;
    const latestContainer = document.getElementById('latest-posts');

    function slugToTitle(name) {
      const cleaned = name.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.(md|txt|html)$/, '');
      return cleaned.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
    }

    function dateFromSlug(name) {
      const m = name.match(/^(\d{4})-(\d{2})-(\d{2})/);
      if (!m) return null;
      return new Date(+m[1], +m[2] - 1, +m[3]);
    }

    function formatDate(d) {
      try {
        return d.toLocaleDateString('lt-LT', { year: 'numeric', month: 'long', day: 'numeric' });
      } catch {
        return '';
      }
    }

    async function loadLatest() {
      try {
        const res = await fetch(postsApi);
        if (!res.ok) throw new Error('GitHub API error');
        const files = await res.json();

        const posts = files
          .filter(f => f.name.toLowerCase().endsWith('.md') || f.name.toLowerCase().endsWith('.txt'))
          .sort((a, b) => {
            const da = dateFromSlug(a.name) || new Date(0);
            const db = dateFromSlug(b.name) || new Date(0);
            return db - da;
          })
          .slice(0, 2); // only show 2 posts

        if (posts.length === 0) {
          latestContainer.innerHTML = '<p class="muted">No posts found yet.</p>';
          return;
        }

        const cards = await Promise.all(posts.map(async p => {
          const title = slugToTitle(p.name);
          const date = dateFromSlug(p.name);
          const dateStr = date ? formatDate(date) : '';
          let preview = '';

          try {
            const raw = await fetch(p.download_url).then(r => r.text());
            preview = raw.split(/\r?\n/).slice(0, 3).join(' ')
              .replace(/[#*_`>\[\]]+/g, '')
              .trim();
          } catch {
            preview = '(Unable to load preview)';
          }

          const link = `post.html?file=${encodeURIComponent(p.name)}`;
          return `
            <article class="card post">
              <a class="card-link" href="${link}">
                <div class="thumb" aria-hidden="true"></div>
                <div class="card-body">
                  <h2 class="card-title">${title}</h2>
                  <p class="card-meta">${dateStr}</p>
                  <p class="card-text">${preview}</p>
                </div>
              </a>
            </article>
          `;
        }));

        latestContainer.innerHTML = cards.join('');
      } catch (err) {
        latestContainer.innerHTML = `<p class="muted">Error loading posts: ${err.message}</p>`;
        console.error(err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadLatest);
  </script>
</body>
</html>
