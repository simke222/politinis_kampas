<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post — politinis_kampas</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">politinis_kampas</a>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="blog.html" class="active">Blog</a>
        <a href="feed.html">RSS Feed</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container article">
    <article id="article">
      <h1 id="post-title">Loading…</h1>
      <p id="post-meta" class="card-meta"></p>
      <div id="post-content" class="post-body muted">Fetching content…</div>
    </article>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <span>© <span id="year"></span> politinis_kampas</span>
      <a class="rss" href="feed.html">RSS Feed Page</a>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Config your repo here:
    const GITHUB_USER = 'simke222';
    const GITHUB_REPO = 'politinis_kampas';
    const GITHUB_BRANCH = 'main';

    const params = new URLSearchParams(location.search);
    const filename = params.get('file'); // e.g., 2025-10-06-gaza-analysis.md

    function slugToTitle(slug){
      // remove date prefix if present
      const cleaned = slug.replace(/^\\d{4}-\\d{2}-\\d{2}-/,'').replace(/\\.(md|txt)$/,'');
      return cleaned.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
    }

    function dateFromSlug(slug){
      const m = slug.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);
      if(!m) return '';
      const d = new Date(+m[1], +m[2]-1, +m[3]);
      return d.toLocaleDateString(undefined, {year:'numeric', month:'long', day:'numeric'});
    }

    async function loadPost(){
      if(!filename){
        document.getElementById('post-title').textContent = 'Post not found';
        document.getElementById('post-content').textContent = 'Missing ?file=… parameter.';
        return;
      }

      const rawUrl = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/posts/${encodeURIComponent(filename)}`;
      try{
        const res = await fetch(rawUrl);
        if(!res.ok) throw new Error('Fetch failed');
        const text = await res.text();

        const title = slugToTitle(filename);
        const date = dateFromSlug(filename);
        document.getElementById('post-title').textContent = title;
        document.title = `${title} — politinis_kampas`;
        document.getElementById('post-meta').textContent = date ? `${date}` : '';

        // If .md → convert, if .txt → wrap in <pre>
        let html;
        if(/\\.md$/i.test(filename)){
          const conv = new showdown.Converter({simplifiedAutoLink:true, strikethrough:true, tables:true});
          html = conv.makeHtml(text);
        }else{
          html = `<pre>${text.replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))}</pre>`;
        }

        // Tip for images: use paths like "images/pic.jpg"
        // (relative to this page), so keep your images in /images
        document.getElementById('post-content').innerHTML = html;

      }catch(e){
        document.getElementById('post-title').textContent = 'Error loading post';
        document.getElementById('post-content').textContent = 'Could not fetch the file. Check file name and repo path.';
        console.error(e);
      }
    }

    loadPost();
  </script>
</body>
</html>
