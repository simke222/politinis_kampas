<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post — politinis_kampas</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/style.css" />
  <style>
    body {
      background: #0b0b0b;
      color: #f8f8f8;
      font-family: 'Inter', system-ui, sans-serif;
      line-height: 1.6;
      margin: 0;
    }

    header {
      background: #000;
      border-bottom: 1px solid #222;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .brand {
      color: #f5c518;
      font-weight: 700;
      text-decoration: none;
      font-size: 1.2rem;
    }

    .nav a {
      margin-left: 1rem;
      color: #f8f8f8;
      text-decoration: none;
    }

    .nav a.active,
    .nav a:hover {
      color: #f5c518;
    }

    main.article {
      max-width: 850px;
      margin: 3rem auto;
      background: #111;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    }

    h1, h2, h3 {
      color: #f5c518;
      margin-top: 1.5rem;
    }

    p {
      margin: 0.5rem 0;
      color: #ddd;
    }

    img {
      max-width: 100%;
      border-radius: 10px;
      margin: 1rem 0;
    }

    pre {
      background: #191919;
      color: #f5c518;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
    }

    footer {
      text-align: center;
      padding: 2rem 0;
      color: #999;
    }

    @media (max-width: 768px) {
      main.article {
        margin: 1rem;
        padding: 1.2rem;
      }
      header {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <header class="site-header">
    <a class="brand" href="index.html">politinis_kampas</a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="blog.html" class="active">Blog</a>
      <a href="feed.html">RSS Feed</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main class="container article">
    <article id="article">
      <h1 id="post-title">Loading…</h1>
      <p id="post-meta" class="card-meta"></p>
      <div id="post-content" class="post-body">Fetching content…</div>
    </article>
  </main>

  <footer class="site-footer">
    <p>© <span id="year"></span> politinis_kampas</p>
    <a class="rss" href="feed.html" style="color:#f5c518;">RSS Feed Page</a>
  </footer>

  <!-- ✅ Load Showdown AFTER body so it's available -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // Config your repo here:
  const GITHUB_USER = 'simke222';
  const GITHUB_REPO = 'politinis_kampas';
  const GITHUB_BRANCH = 'main';

  const params = new URLSearchParams(location.search);
  const filename = params.get('file'); // e.g., 2025-10-06-gaza-analysis.md

  function slugToTitle(slug){
    return slug
      .replace(/^\d{4}-\d{2}-\d{2}-/, '')
      .replace(/\.(md|txt)$/,'')
      .split('-')
      .map(w => w.charAt(0).toUpperCase() + w.slice(1))
      .join(' ');
  }

  function dateFromSlug(slug){
    const m = slug.match(/^(\d{4})-(\d{2})-(\d{2})/);
    if(!m) return '';
    const d = new Date(+m[1], +m[2]-1, +m[3]);
    return d.toLocaleDateString('lt-LT', {year:'numeric', month:'long', day:'numeric'});
  }

  async function loadPost(){
    const articleEl = document.getElementById('post-content');
    if(!filename){
      document.getElementById('post-title').textContent = 'Post not found';
      articleEl.textContent = 'Missing ?file= parameter.';
      return;
    }

    const rawUrl = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/posts/${encodeURIComponent(filename)}`;

    try{
      const res = await fetch(rawUrl);
      if(!res.ok) throw new Error('Fetch failed');
      const text = await res.text();

      const title = slugToTitle(filename);
      const date = dateFromSlug(filename);
      document.getElementById('post-title').textContent = title;
      document.title = `${title} — politinis_kampas`;
      document.getElementById('post-meta').textContent = date ? `${date}` : '';

      // ✅ Proper markdown conversion
      const converter = new showdown.Converter({
        simplifiedAutoLink: true,
        tables: true,
        strikethrough: true,
        ghCodeBlocks: true,
        smoothLivePreview: true
      });

      // Make sure newlines are preserved correctly
      const normalized = text.replace(/\r\n/g, "\n").trim();
      const html = converter.makeHtml(normalized);

      articleEl.innerHTML = html;

      // Optional: style markdown headers
      document.querySelectorAll('h1,h2,h3').forEach(h => {
        h.style.color = '#ffcc00';
        h.style.marginTop = '1.4rem';
        h.style.marginBottom = '0.6rem';
      });

    }catch(e){
      document.getElementById('post-title').textContent = 'Error loading post';
      articleEl.textContent = 'Could not fetch or render the file.';
      console.error(e);
    }
  }

  document.addEventListener('DOMContentLoaded', loadPost);
</script>

</body>
</html>
